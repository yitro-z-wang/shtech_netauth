_msgs = {
      "1006": 'Deregistration failed because the session has timed out. Possible causes: 1. MAC address-prioritized Portal authentication is still valid for the current user, but the authenticated session has become ineffective. 2. The user has gone beyond the coverage area of WLAN.',
      "1009": 'Access error.',
      "1110": 'Failed to get password policy.',
      "1113": 'The password will expire. Remaining days:{0}',
      "2001": 'Invalid parameter.',
      "2002": 'Invalid password length.',
      "2003": 'The password cannot start or end with a space.',
      "2004": 'The password differs from the confirm password.',
      "2005": 'The password must contain digits.',
      "2006": 'The password does not contain special characters.',
      "2007": 'The password cannot be the same as the user name or its characters in reverse order.',
      "2008": 'The number of identical characters in the password exceeds the limit.',
      "2009": 'The password must contain uppercase letters.',
      "2010": 'The password must contain lowercase letters.',
      "2011": 'Password repetition not allowed does not meet the requirements.',
      "2012": 'The new password cannot be the same as the old password.',
      "2013": 'The password can only contain digits, letters, and special characters.',
      "3000": 'The parameter is empty.',
      "3001": 'Invalid parameter.',
      "3002": 'The user group does not exist.',
      "3003": 'The user name already exists.',
      "3004": 'Invalid email format.',
      "3006": 'Invalid phone number format.',
      "3009": 'User name field is too long.',
      "3010": 'Invalid verification code.',
      "3011": 'The user group to which users belong does not exist.',
      "3012": 'The appropriate user group is not configured.',
      "3014": 'The total number of users has reached the upper limit.',
      "3016": 'Registration is not allowed now.',
      "3017": 'The device does not exist.',
      "3018": 'Registration failed.',
      "3019": 'An internal server exception occurs.',
      "3020": 'The mobile number has been registered by another user.',
      "3021": 'The user name has been registered by another user.',
      "3022": 'The interval at which you obtain passwords cannot be shorter than 1 minute.',
      "3023": 'The guest policy is incorrectly configured. Please contact your system administrator.',
      "3024": 'The upper limit is exceeded. Try again later.',
      "3025": 'Invalid registration information.',
      "3026": 'The receptionist you entered is incorrect.Please re-enter it.',
      "3027": 'The receptionist email address you entered is invalid or is not in the reception trustlist.',
      "4000": 'Enter your user name and password.',
      "4001": 'Enter the verification code.',
      "4002": 'Invalid verification code.',
      "4003": 'The current user cannot reset the password.',
      "4004": 'The mobile number of the current user is not configured.',
      "4005": 'The email address of the current user is not configured.',
      "4006": 'The method used to obtain a dynamic verification code is incorrect.',
      "4007": 'Failed to obtain a dynamic verification code. Try again later.',
      "4008": 'Enter the dynamic verification code.',
      "4009": 'Incorrect dynamic verification code. If the user enters an incorrect value for {0} consecutive times, the user will be locked for {1} minutes',
      "4010": 'Enter the new password.',
      "4011": 'Enter the confirm password.',
      "4012": 'The two passwords do not match.',
      "4013": 'The device does not exist.',
      "4014": 'Failed to reset the password. Try again later.',
      "4015": 'The user has been locked. Remaining locking time (min):{0}.',
      "4016": 'You can obtain only one dynamic verification code within 1 minute.',
      "4017": 'The dynamic verification code is incorrect or has expired. Enter a valid one.',
      "4018": 'The password cannot be the same as the latest {0} historical passwords.',
      "4019": 'Invalid user name.',
      "4020": 'The account does not exist or does not support this function.',
      "4021": 'Please enter phone number',
      "4022": 'The RSA dynamic password is incorrect.',
      "4023": 'Enter the RSA dynamic password. ',
      "4024": 'Failed to connect to the RSA dynamic password server. ',
      "10100": 'Parameter error.',
      "10101": 'The user notice is not checked.',
      "10102": 'Authentication type is illegal.',
      "10103": 'User ip address is illegal.',
      "10104": 'User mac address is illegal.',
      "10105": 'Already on the current network. No switchover is required.',
      "10106": 'Invalid target network.',
      "10107": 'Failed to switch to the network.',
      "10200": 'Device information verification failed.',
      "10201": 'Authentication failed because the device does not exist.',
      "10202": 'Abnormal license status. No license is imported or the license has expired.',
      "10203": 'ssid does not exist. ',
      "10206": 'Abnormal license authentication status.',
      "10300": 'Authentication type verification failed.',
      "10301": 'Authentication is disabled.',
      "10302": 'Agile Control built-in authentication is not enabled.',
      "10303": 'Username password authentication is not enabled.',
      "10304": 'Anonymous authentication is not enabled.',
      "10305": 'The SMS authentication is not enabled.',
      "10306": 'WeChat authentication is not enabled.',
      "10307": 'Facebook authentication is not enabled.',
      "10308": 'passcode authentication is not enabled.',
      "10309": 'PPSK authentication is not enabled.',
      "10310": 'Twitter authentication is not enabled.',
      "10311": 'QQ authentication is not enabled.',
      "10312": 'Sina authentication is not enabled.',
      "10313": 'Social media authentication is disabled.',
      "10314": 'Authentication failed: Public QR code authentication is not enabled.',
      "10315": 'Authentication failed: Google authentication is not enabled.',
      "10400": 'MAC free-authentication failed.',
      "10401": 'MAC free-authentication is not enabled.',
      "10402": 'MAC-free authentication record was not found.',
      "10403": 'MAC-free authentication expires.',
      "10404": 'MAC-free authentication does not support username and password authentication.',
      "10405": 'MAC-free authentication does not support anonymous authentication.',
      "10406": 'MAC-free authentication does not support SMS authentication.',
      "10407": 'MAC-free authentication does not support WeChat authentication.',
      "10408": 'MAC-free authentication does not support social media authentication.',
      "10409": 'MAC-free authentication does not support passcode authentication.',
      "10410": 'The third-party authentication and certification strategy does not exist.',
      "10500": 'User information verification failed.',
      "10501": 'User does not exist.',
      "10503": 'user name or password error.',
      "10504": 'User has expired.',
      "10505": 'The user has been locked. Remaining locking time (min):{0}.',
      "10506": 'Invalid passcode.',
      "10508": 'Authentication failed. Contact the administrator.',
      "10509": 'The self-registered account is pending approval.',
      "10510": 'The self-registered account approval is rejected.',
      "10511": 'The self-registered account is ineffective.',
      "10512": 'Change your password upon first login.',
      "10514": 'The user has been locked. Contact the administrator. ',
      "10513": 'Authentication failed because the password has expired. ',
      "10515": 'Authentication failed, The user does not comply with the authentication rules and is denied access.',
      "10516": 'Authentication failed: The maximum binding number of self-learning parameters exceeds the upper limit.',
      "10517": 'Authentication failure: The account is not configured with access parameters (do not allow accounts with unbound parameters to access the network).',
      "10518": 'Authentication failed: terminal access MAC does not match.',
      "10519": 'Authentication failed: Terminal access IP does not match.',
      "10520": 'Authentication failed: The terminal authentication device IP does not match.',
      "10521": 'Failed to associate mobile phone number',
      "10525": 'The MAC address is added to the blacklist.',
      "10526": 'Authentication failed: The account login type does not match.',
      "10527": 'Authentication failed: Failed to verify the QR code information.',
      "10528": 'Authentication failed: The MAC account has expired.',
      "10529": 'Authentication failed: The current account is used only for mobile certificate authentication.',
      "10530": 'The current user does not support password change.',
      "10531": 'Failed to obtain the password. Contact the administrator.',
      "10542": 'Authentication failed. Please do not repeat authentication within 3 seconds.',
      "10605": 'Authentication failed. No more traffic or online duration is available.',
      "10700": 'Authorization failed.',
      "10701": 'Online failed.',
      "10702": 'HACA user already exists.',
      "10703": 'HACA users are processing, not UP processing.',
      "10704": 'Non-HACA users are processing, not UP processing.',
      "10705": 'Online rejection, cover users failed.',
      "10706": 'Users have reached access restrictions.',
      "10707": 'Roaming local cant find the user.',
      "10708": 'The online authorization data is incorrect.',
      "10709": 'The users interface could not be found. The user has a mac/ip error.',
      "10710": 'Authentication failed.',
      "10711": 'Authentication failed because the number of online users has reached the upper limit.',
      "10712": 'Authentication failed: The number of access users exceeded the maximum.',
      "10713": 'Flow or online time is exhausted.',
      "10715": 'Authorization rules deny user access.',
      "10716": 'No available license. Contact the administrator.',
      "10800": 'Social media authentication failed.',
      "10801": 'Incorrect WeChat parameter configuration. Contact the administrator.',
      "10802": 'Incorrect WeChat token.',
      "10803": 'Your station will be locked for {0} minute(s).',
      "10804": 'The period for temporary permit of WeChat account timed out.',
      "10805": 'Authentication failed: failed to user information.',
      "10806": 'Authentication failed. The WeChat public account is not concerned. Please pay attention to the WeChat public account and reconnect to the network.',
      "10807": 'Follow WeChat public account is not enabled.',
      "10809": 'Social media parameter validation failed. Contact the administrator.',
      "10810": 'Authentication failed due to a network exception.',
      "10811": 'Authentication failed: Failed to obtain WeChat information.',
      "10812": 'Authentication failed: Twitter authentication timed out.',
      "10813": 'Authentication failed: The WeChat link has expired. Obtain another one.',
      "10814": 'Please bind a mobile number.',
      "10815": 'Authentication failed: Authorization timed out. Please re-authorize.',
      "10816": 'Failed to bind the mobile number. Bind the mobile number again.',
      "10817": 'Google account domain name verification failed.',
      "10818": 'Failed to get Google server response.',
      "10900": 'An internal server exception occurs.',
      "10901": 'An internal server exception occurs.',
      "10903": 'Failed to change the password. Contact the administrator.',
      "10904": 'The CoA type used in CWA is not supported.',
      "10905": 'Access rejection: The user is not authenticated and authorized by 802.1X.',
      "10906": 'Authentication failed. CWA authentication and authorization have been performed.',
      "10907": 'RADIUS server authentication failed.',
      "10908": 'The CWA account does not support RADIUS relay.',
      "13027": 'Incorrect email address format.',
      "13028": 'Invalid registration code.',
      "9": 'The SSID or IP address for this page is not the currently associated SSID. You will be switched to a correct page pushed for the current SSID.',
      "10": 'The SSID or IP address for this page is not the currently associated SSID. You will be switched to a correct page pushed for the current SSID.',
      # Portal2.0 新增
      "20000": 'device response is illegal.',
      "20001": 'device response is illegal. Please check if the device and controller keys are the same.',
      # 认证失败：设备响应异常，请检查设备和控制器密钥是否一致
      "20002": 'device response timed out.',
      # 认证失败：设备未响应认证请求
      "20100": 'An internal server exception occurs.',
      "20101": 'An internal server exception occurs.',
      "20102": 'The system is busy, please try again later.',
      "20103": 'The auth packet failed to be sent.',
      "20104": 'Authentication request timed out.',
      "20200": 'Device response to Challenge packet failed.',
      "20201": 'Device refuses to respond to Challenge packet.',
      # 认证失败：设备响应Challenge请求失败
      "20202": 'Device response to Challenge packet failed.',
      # 认证失败：设备响应Challenge请求失败
      "20203": 'Device is authing, please try again later.',
      # 认证失败：设备响应Challenge请求失败
      "20204": 'Device response to Challenge packet failed.',
      # 认证失败：设备响应Challenge请求失败
      "20205": 'Device has reached the maximum access limit.',
      # 认证失败：超出最大接入数控制
      "20206": 'Device prohibits the user access.',
      # 认证失败：设备拒绝用户接入
      "20207": 'Device response is illegal.',
      # 认证失败：设备响应异常
      "20208": 'Device response timed out.',
      # 认证失败：设备响应超时
      "20400": 'Device response authentication packet failed or the Radius server authentication failed.',
      "20401": 'Device refuses to respond to authentication packet.',
      # 认证失败：设备响应Auth请求失败
      "20402": 'Device response authentication packet failed.',
      # 认证失败：设备响应Auth请求失败
      "20403": 'Device is authing, please try again later.',
      # 认证失败：设备响应Auth请求失败
      "20404": 'Device response authentication packet failed or the Radius server authentication failed.',
      # 认证失败：设备响应Auth请求失败
      "20405": 'The device has reached the maximum access limit.',
      # 认证失败：超出最大接入数控制
      "20406": 'Device response timed out',
      # 认证失败：设备响应超时
      "20407": 'The SMS server is not configured. Contact the administrator.',
      "20408": 'The email server is not configured. Contact the administrator.',
}

def msg(id):
  if id in _msgs:
    return _msgs[id]
  else:
    return id

import requests
from urllib.parse import urlparse, parse_qs
from time import sleep
from sys import exit

while True:
  try:
    r = requests.get('http://baidu.com/')
  except requests.exceptions.RequestException:
    print('request exception')
    sleep(1)
    continue
  if 'shanghaitech' in r.url:
    params = {
      k: v if len(v) > 1 else v[0]
      for k, v in parse_qs(urlparse(r.url).query).items()
    }
    print('params =', params)
    r = requests.post(
      'https://Net-auth.shanghaitech.edu.cn:19008/portalauth/login',
      data={
        'pushPageId': params['pushPageId'],
        'authType': params['authType'],
        'ssid': params['ssid'],
        'uaddress': params['uaddress'],
        'umac': params['umac'],
        'acip': params['ac-ip'],
        'agreed': 1,
        'validCode': 'aaaa',
        'userName': '',
        'userPass': '',
      }
    )
    print('response =', r.text)
    j = r.json()
    if not j['success']:
      print('error_msg =', msg(j['errorcode']))
      exit(1)
    else:
      print('auth successfully')
  else:
    print('no need to auth')
  sleep(10)
